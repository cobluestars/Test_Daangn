"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/check-peak-time";
exports.ids = ["pages/api/check-peak-time"];
exports.modules = {

/***/ "@google-cloud/bigquery":
/*!*****************************************!*\
  !*** external "@google-cloud/bigquery" ***!
  \*****************************************/
/***/ ((module) => {

module.exports = require("@google-cloud/bigquery");

/***/ }),

/***/ "(api)/./src/lib/bigquery.ts":
/*!*****************************!*\
  !*** ./src/lib/bigquery.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"checkAndRecommendPosts\": () => (/* binding */ checkAndRecommendPosts)\n/* harmony export */ });\n/* harmony import */ var _google_cloud_bigquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google-cloud/bigquery */ \"@google-cloud/bigquery\");\n/* harmony import */ var _google_cloud_bigquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_google_cloud_bigquery__WEBPACK_IMPORTED_MODULE_0__);\n// /src/lib/bigquery.ts\n\n//BigQuery 클라이언트를 초기화\nconst BigQueryClient = new _google_cloud_bigquery__WEBPACK_IMPORTED_MODULE_0__.BigQuery();\n//추천 게시글을 결정하기 위한 기준값 설정\nconst thresholdMultiplier = 1.5;\nlet peakHoursThreshold = 1600;\n//현재 시간을 확인, peakHoursThreshold 기준으로 추천 게시글을 결정\nconst checkAndRecommendPosts = async ()=>{\n    // UTC 시간을 가져온 후, 9시간(한국 시간대)을 더함\n    const now = new Date();\n    const koreaTimeOffset = 9 * 60; // 9 hours in minutes\n    const kstDate = new Date(now.getTime() + koreaTimeOffset * 60 * 1000);\n    // 현재 시간을 HH 형식으로 변환\n    const currentHourOnly = kstDate.toISOString().slice(11, 13);\n    // 로그로 현재 시간 출력\n    console.log(\"쿼리에 사용될 현재 시간(Hour only, KST):\", currentHourOnly);\n    // 현재 시간대의 타임스탬프 생성 수를 BigQuery에서 쿼리함\n    const options = {\n        query: `\r\n            SELECT hour, count\r\n            FROM dataherd_step3.dataherd_timestamp\r\n            WHERE hour LIKE '%${currentHourOnly}';\r\n        `,\n        location: \"asia-northeast3\",\n        params: {\n            currentHour: `${currentHourOnly}`\n        }\n    };\n    try {\n        // 쿼리를 실행하고 결과를 가져옴\n        const [job] = await BigQueryClient.createQueryJob(options);\n        const [rows] = await job.getQueryResults();\n        //추천 게시글을 결정\n        if (rows.length > 0 && rows[0].count >= peakHoursThreshold * thresholdMultiplier) {\n            //클라이언트에 반환될 데이터 설정\n            const recommendationData = {\n                isPeakTime: true,\n                message: \"피크 타임입니다! 식당 및 카페를 체크해보세요!\",\n                now: kstDate\n            };\n            //추천 데이터를 클라이언트로 보냄\n            return recommendationData;\n        } else {\n            return {\n                isPeakTime: false\n            };\n        }\n    } catch (e) {\n        console.error(\"Error querying BigQuery\", e);\n        throw e;\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2JpZ3F1ZXJ5LnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHVCQUF1QjtBQUUyQjtBQUVsRCxxQkFBcUI7QUFDckIsTUFBTUMsY0FBYyxHQUFHLElBQUlELDREQUFRLEVBQUU7QUFFckMsd0JBQXdCO0FBQ3hCLE1BQU1FLG1CQUFtQixHQUFHLEdBQUc7QUFDL0IsSUFBSUMsa0JBQWtCLEdBQUcsSUFBSTtBQUU3QiwrQ0FBK0M7QUFDeEMsTUFBTUMsc0JBQXNCLEdBQUUsVUFBWTtJQUM3QyxpQ0FBaUM7SUFDakMsTUFBTUMsR0FBRyxHQUFHLElBQUlDLElBQUksRUFBRTtJQUN0QixNQUFNQyxlQUFlLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBRSxxQkFBcUI7SUFDckQsTUFBTUMsT0FBTyxHQUFHLElBQUlGLElBQUksQ0FBQ0QsR0FBRyxDQUFDSSxPQUFPLEVBQUUsR0FBR0YsZUFBZSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7SUFFckUsb0JBQW9CO0lBQ3BCLE1BQU1HLGVBQWUsR0FBR0YsT0FBTyxDQUFDRyxXQUFXLEVBQUUsQ0FBQ0MsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFFM0QsZUFBZTtJQUNmQyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxnQ0FBZ0MsRUFBRUosZUFBZSxDQUFDLENBQUM7SUFFL0QscUNBQXFDO0lBQ3JDLE1BQU1LLE9BQU8sR0FBRztRQUNaQyxLQUFLLEVBQUUsQ0FBQztRQUtSQyxRQUFRLEVBQUU7UUFDVkMsTUFBTSxFQUFFO1lBQUVDLFdBQVcsRUFBRSxDQUFDLEVBQUVULGVBQWUsQ0FBQyxDQUFDO1NBQUU7S0FDaEQ7SUFHRCxJQUFJO1FBQ0EsbUJBQW1CO1FBQ25COztRQUdBO1FBQ0EsSUFBSVksSUFBSSxDQUFDRSxNQUFNLEdBQUcsQ0FBQztZQUVmLG1CQUFtQjtZQUNuQixNQUFNRSxrQkFBa0IsR0FBRztnQkFDdkJDO2dCQUNBQyxPQUFPLEVBQUUsNEJBQTRCO2dCQUNyQ3ZCLEdBQUcsRUFBRUcsT0FBTzthQUNmO1lBRUQsbUJBQW1CO1lBQ25CLE9BQU9rQixrQkFBa0IsQ0FBQztRQUM5QixPQUFPO1lBQ0g7Z0JBQVNDLFVBQVUsRUFBRTthQUFPO1FBQ2hDLENBQUM7SUFDTCxFQUFFLE9BQU9FLENBQUMsRUFBRTtRQUNSaEIsT0FBTyxDQUFDaUIsS0FBSyxDQUFDO1FBQ2QsTUFBTUQ7SUFDVixDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3Rlc3RfZGFhbmduLy4vc3JjL2xpYi9iaWdxdWVyeS50cz8zNDZjIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIC9zcmMvbGliL2JpZ3F1ZXJ5LnRzXHJcblxyXG5pbXBvcnQgeyBCaWdRdWVyeSB9IGZyb20gXCJAZ29vZ2xlLWNsb3VkL2JpZ3F1ZXJ5XCI7XHJcblxyXG4vL0JpZ1F1ZXJ5IO2BtOudvOydtOyWuO2KuOulvCDstIjquLDtmZRcclxuY29uc3QgQmlnUXVlcnlDbGllbnQgPSBuZXcgQmlnUXVlcnkoKTtcclxuXHJcbi8v7LaU7LKcIOqyjOyLnOq4gOydhCDqsrDsoJXtlZjquLAg7JyE7ZWcIOq4sOykgOqwkiDshKTsoJVcclxuY29uc3QgdGhyZXNob2xkTXVsdGlwbGllciA9IDEuNTtcclxubGV0IHBlYWtIb3Vyc1RocmVzaG9sZCA9IDE2MDA7XHJcblxyXG4vL+2YhOyerCDsi5zqsITsnYQg7ZmV7J24LCBwZWFrSG91cnNUaHJlc2hvbGQg6riw7KSA7Jy866GcIOy2lOyynCDqsozsi5zquIDsnYQg6rKw7KCVXHJcbmV4cG9ydCBjb25zdCBjaGVja0FuZFJlY29tbWVuZFBvc3RzID1hc3luYyAoKSA9PiB7XHJcbiAgICAvLyBVVEMg7Iuc6rCE7J2EIOqwgOyguOyYqCDtm4QsIDnsi5zqsIQo7ZWc6rWtIOyLnOqwhOuMgCnsnYQg642U7ZWoXHJcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgY29uc3Qga29yZWFUaW1lT2Zmc2V0ID0gOSAqIDYwOyAvLyA5IGhvdXJzIGluIG1pbnV0ZXNcclxuICAgIGNvbnN0IGtzdERhdGUgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpICsga29yZWFUaW1lT2Zmc2V0ICogNjAgKiAxMDAwKTtcclxuXHJcbiAgICAvLyDtmITsnqwg7Iuc6rCE7J2EIEhIIO2YleyLneycvOuhnCDrs4DtmZhcclxuICAgIGNvbnN0IGN1cnJlbnRIb3VyT25seSA9IGtzdERhdGUudG9JU09TdHJpbmcoKS5zbGljZSgxMSwgMTMpO1xyXG5cclxuICAgIC8vIOuhnOq3uOuhnCDtmITsnqwg7Iuc6rCEIOy2nOugpVxyXG4gICAgY29uc29sZS5sb2coXCLsv7zrpqzsl5Ag7IKs7Jqp65CgIO2YhOyerCDsi5zqsIQoSG91ciBvbmx5LCBLU1QpOlwiLCBjdXJyZW50SG91ck9ubHkpO1xyXG5cclxuICAgIC8vIO2YhOyerCDsi5zqsITrjIDsnZgg7YOA7J6E7Iqk7YOs7ZSEIOyDneyEsSDsiJjrpbwgQmlnUXVlcnnsl5DshJwg7L+866as7ZWoXHJcbiAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgIHF1ZXJ5OiBgXHJcbiAgICAgICAgICAgIFNFTEVDVCBob3VyLCBjb3VudFxyXG4gICAgICAgICAgICBGUk9NIGRhdGFoZXJkX3N0ZXAzLmRhdGFoZXJkX3RpbWVzdGFtcFxyXG4gICAgICAgICAgICBXSEVSRSBob3VyIExJS0UgJyUke2N1cnJlbnRIb3VyT25seX0nO1xyXG4gICAgICAgIGAsXHJcbiAgICAgICAgbG9jYXRpb246ICdhc2lhLW5vcnRoZWFzdDMnLFxyXG4gICAgICAgIHBhcmFtczogeyBjdXJyZW50SG91cjogYCR7Y3VycmVudEhvdXJPbmx5fWAgfVxyXG4gICAgfTtcclxuXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyDsv7zrpqzrpbwg7Iuk7ZaJ7ZWY6rOgIOqysOqzvOulvCDqsIDsoLjsmLRcclxuICAgICAgICBjb25zdFtqb2JdID0gYXdhaXQgQmlnUXVlcnlDbGllbnQuY3JlYXRlUXVlcnlKb2Iob3B0aW9ucyk7XHJcbiAgICAgICAgY29uc3Rbcm93c10gPSBhd2FpdCBqb2IuZ2V0UXVlcnlSZXN1bHRzKCk7XHJcblxyXG4gICAgICAgIC8v7LaU7LKcIOqyjOyLnOq4gOydhCDqsrDsoJVcclxuICAgICAgICBpZiAocm93cy5sZW5ndGggPiAwICYmIHJvd3NbMF0uY291bnQgPj0gcGVha0hvdXJzVGhyZXNob2xkICogdGhyZXNob2xkTXVsdGlwbGllcikge1xyXG5cclxuICAgICAgICAgICAgLy/tgbTrnbzsnbTslrjtirjsl5Ag67CY7ZmY65CgIOuNsOydtO2EsCDshKTsoJVcclxuICAgICAgICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25EYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgaXNQZWFrVGltZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICftlLztgawg7YOA7J6E7J6F64uI64ukISDsi53ri7kg67CPIOy5tO2OmOulvCDssrTtgaztlbTrs7TshLjsmpQhJyxcclxuICAgICAgICAgICAgICAgIG5vdzoga3N0RGF0ZVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy/stpTsspwg642w7J207YSw66W8IO2BtOudvOydtOyWuO2KuOuhnCDrs7Trg4RcclxuICAgICAgICAgICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uRGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4geyBpc1BlYWtUaW1lOiBmYWxzZSB9XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHF1ZXJ5aW5nIEJpZ1F1ZXJ5JywgZSk7XHJcbiAgICAgICAgdGhyb3cgZTtcclxuICAgIH1cclxufSJdLCJuYW1lcyI6WyJCaWdRdWVyeSIsIkJpZ1F1ZXJ5Q2xpZW50IiwidGhyZXNob2xkTXVsdGlwbGllciIsInBlYWtIb3Vyc1RocmVzaG9sZCIsImNoZWNrQW5kUmVjb21tZW5kUG9zdHMiLCJub3ciLCJEYXRlIiwia29yZWFUaW1lT2Zmc2V0Iiwia3N0RGF0ZSIsImdldFRpbWUiLCJjdXJyZW50SG91ck9ubHkiLCJ0b0lTT1N0cmluZyIsInNsaWNlIiwiY29uc29sZSIsImxvZyIsIm9wdGlvbnMiLCJxdWVyeSIsImxvY2F0aW9uIiwicGFyYW1zIiwiY3VycmVudEhvdXIiLCJqb2IiLCJjcmVhdGVRdWVyeUpvYiIsInJvd3MiLCJnZXRRdWVyeVJlc3VsdHMiLCJsZW5ndGgiLCJjb3VudCIsInJlY29tbWVuZGF0aW9uRGF0YSIsImlzUGVha1RpbWUiLCJtZXNzYWdlIiwiZSIsImVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/bigquery.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/check-peak-time.ts":
/*!******************************************!*\
  !*** ./src/pages/api/check-peak-time.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_bigquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/bigquery */ \"(api)/./src/lib/bigquery.ts\");\n// /src/pages/api/check-peak-time.ts\n// bigquery로부터 피크 타임 정보를 받아서, 클라이언트단에 피크 타임을 알려주고 추천 게시글이 나오도록 도와줌\n\nasync function handler(req, res) {\n    if (req.method === \"GET\") {\n        try {\n            const recommendationData = await (0,_lib_bigquery__WEBPACK_IMPORTED_MODULE_0__.checkAndRecommendPosts)();\n            res.status(200).json(recommendationData);\n        } catch (error) {\n            res.status(500).json({\n                message: \"서버 에러가 발생했습니다.\",\n                error\n            });\n        }\n    } else {\n        res.setHeader(\"Allow\", [\n            \"GET\"\n        ]);\n        res.status(405).end(`Method ${req.method} Not Allowed`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2NoZWNrLXBlYWstdGltZS50cy5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLG9DQUFvQztBQUNwQyxrRUFBa0U7QUFHTjtBQUU3QyxlQUFlQyxPQUFPLENBQ25DQyxHQUFtQixFQUNuQkMsR0FBb0IsRUFDcEI7SUFDQSxJQUFJRCxHQUFHLENBQUNFLE1BQU0sS0FBSyxLQUFLLEVBQUU7UUFDeEIsSUFBSTtZQUNGLE1BQU1DLGtCQUFrQixHQUFHLE1BQU1MLHFFQUFzQixFQUFFO1lBQ3pERyxHQUFHLENBQUNHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDRixrQkFBa0IsQ0FBQyxDQUFDO1FBQzNDLEVBQUUsT0FBT0csS0FBSyxFQUFFO1lBQ2RMLEdBQUcsQ0FBQ0csTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7Z0JBQUVFLE9BQU8sRUFBRSxnQkFBZ0I7Z0JBQUVELEtBQUs7YUFBRSxDQUFDLENBQUM7UUFDN0QsQ0FBQztJQUNILE9BQU87UUFDTEwsR0FBRyxDQUFDTyxTQUFTLENBQUMsT0FBTyxFQUFFO1lBQUMsS0FBSztTQUFDLENBQUMsQ0FBQztRQUNoQ1AsR0FBRyxDQUFDRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNLLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRVQsR0FBRyxDQUFDRSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3Rlc3RfZGFhbmduLy4vc3JjL3BhZ2VzL2FwaS9jaGVjay1wZWFrLXRpbWUudHM/ODk0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyAvc3JjL3BhZ2VzL2FwaS9jaGVjay1wZWFrLXRpbWUudHNcclxuLy8gYmlncXVlcnnroZzrtoDthLAg7ZS87YGsIO2DgOyehCDsoJXrs7Trpbwg67Cb7JWE7IScLCDtgbTrnbzsnbTslrjtirjri6jsl5Ag7ZS87YGsIO2DgOyehOydhCDslYzroKTso7zqs6Ag7LaU7LKcIOqyjOyLnOq4gOydtCDrgpjsmKTrj4TroZ0g64+E7JmA7KSMXHJcblxyXG5pbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcclxuaW1wb3J0IHsgY2hlY2tBbmRSZWNvbW1lbmRQb3N0cyB9IGZyb20gJy4uLy4uL2xpYi9iaWdxdWVyeSc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxyXG4gIHJlcTogTmV4dEFwaVJlcXVlc3QsXHJcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2VcclxuKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbkRhdGEgPSBhd2FpdCBjaGVja0FuZFJlY29tbWVuZFBvc3RzKCk7XHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHJlY29tbWVuZGF0aW9uRGF0YSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICfshJzrsoQg7JeQ65+s6rCAIOuwnOyDne2WiOyKteuLiOuLpC4nLCBlcnJvciB9KTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCBbJ0dFVCddKTtcclxuICAgIHJlcy5zdGF0dXMoNDA1KS5lbmQoYE1ldGhvZCAke3JlcS5tZXRob2R9IE5vdCBBbGxvd2VkYCk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImNoZWNrQW5kUmVjb21tZW5kUG9zdHMiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwicmVjb21tZW5kYXRpb25EYXRhIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwibWVzc2FnZSIsInNldEhlYWRlciIsImVuZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/check-peak-time.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./src/pages/api/check-peak-time.ts"));
module.exports = __webpack_exports__;

})();